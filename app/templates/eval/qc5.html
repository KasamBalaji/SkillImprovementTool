{% extends "eval/base_type.html" %}
{% block title %}Essay{% endblock %}

{% block page_content %}

<style>
    #elapsed-time {
        float:right;
}
.heading{
    background-color: black;
    color:white;
}
</style>
<button type="button" class="btn btn-primary" id="elapsed-time"></button>
<br><br>
<h3 class="heading">Question</h3>
<div class="p-3 mb-2 bg-info text-dark">
<br>
<h4>{{task_data["content"]}}</h4>
<br>
</div>
<h4 class="heading">Reference Links</h4>
<div class="p-3 mb-2 bg-info text-dark">
<br>
<a href='{{task_data["referencelinks"]}}'>{{task_data["referencelinks"]}}</a>
<br>
</div>
<br><br>
<h4 class="heading">Answer</h4>
<textarea name="paragraph_text" id="answer" cols="50" rows="10" style="width: 1122px; height: 330px;"></textarea>
<!-- <input type="text" size="70" id="answer"> -->
<br><br>
<a href="#" role="button" id="btnSubmit" class="btn btn-primary">Submit</a>
<div id="error"></div>

<!-- Scripts -->
<script type="text/javascript">
    //Time and Date Handling Function
    
    //API for time and date functions
    
    var timeAndDateHandling = {
        /** Computes the elapsed time since the moment the function is called in the format mm:ss or hh:mm:ss
         * @param {String} startTime - start time to compute the elapsed time since
         * @returns {String} elapsed time in mm:ss format or hh:mm:ss format if elapsed hours are 0.
         */
        getElapsedTime: function (startTime) {
    
            // Record end time
            let endTime = new Date();
    
            // Compute time difference in milliseconds
            let timeDiff = endTime.getTime() - startTime.getTime();
    
            // Convert time difference from milliseconds to seconds
            timeDiff = timeDiff / 1000;
    
            // Extract integer seconds that dont form a minute using %
            let seconds = Math.floor(timeDiff % 60); //ignoring uncomplete seconds (floor)
    
            // Pad seconds with a zero if neccessary
            let secondsAsString = seconds < 10 ? "0" + seconds : seconds + "";
    
            // Convert time difference from seconds to minutes using %
            timeDiff = Math.floor(timeDiff / 60);
    
            // Extract integer minutes that don't form an hour using %
            let minutes = timeDiff % 60; //no need to floor possible incomplete minutes, becase they've been handled as seconds
    
            // Pad minutes with a zero if neccessary
            let minutesAsString = minutes < 10 ? "0" + minutes : minutes + "";
    
            // Convert time difference from minutes to hours
            timeDiff = Math.floor(timeDiff / 60);
    
            // Extract integer hours that don't form a day using %
            let hours = timeDiff % 24; //no need to floor possible incomplete hours, becase they've been handled as seconds
    
            // Convert time difference from hours to days
            timeDiff = Math.floor(timeDiff / 24);
    
            // The rest of timeDiff is number of days
            let days = timeDiff;
    
            let totalHours = hours + (days * 24); // add days to hours
            let totalHoursAsString = totalHours < 10 ? "0" + totalHours : totalHours + "";
    
            if (totalHoursAsString === "00") {
                return minutesAsString + ":" + secondsAsString;
            } else {
                return totalHoursAsString + ":" + minutesAsString + ":" + secondsAsString;
            }
        }
    }
    
    
    
    window.addEventListener("load", () => {
    console.log('Loaded');
    var elapsedTimeText = document.getElementById("elapsed-time");
    var startTime = new Date({{start_date}});
    
    
    elapsedTimeIntervalRef = setInterval(() => {
            // Compute the elapsed time & display
            elapsedTimeText.innerText = timeAndDateHandling.getElapsedTime(startTime); //pass the actual record start time
    
            // Improvement: Can Stop elapsed time and resert when a maximum elapsed time
            //              has been reached.
        }, 1000);
    });
    </script>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $.extend(
        {
            redirectPost: function(location, args)
            {
                var form = '';
                $.each( args, function( key, value ) {
                    value = value.split('"').join('\"')
                    form += '<input type="hidden" name="'+key+'" value="'+value+'">';
                });
                $('<form action="' + location + '" method="GET">' + form + '</form>').appendTo($(document.body)).submit();
            }
        });
    </script>
<script>
    document.getElementById("btnSubmit").addEventListener("click",function(event){
        event.preventDefault();
        var value =document.getElementById("answer").value;
        if (value==""){document.getElementById("error").innerHTML= "Answer can't be None";   return false; };

    var endDate = new Date();
    var startDate = new Date({{start_date}});
    var time = endDate.getTime() -startDate.getTime();
    var server_data ={answer: value,qno:"{{qno}}",type:"{{type}}",time:time};
    console.log(server_data);
        $.ajax({
    type: "POST",
    url: "{{url_for('eval.submit')}}",
    data: JSON.stringify(server_data),
    contentType: "application/json",
    dataType: 'json',
    success: function(result) {
       console.log("Redirected")
    } 
    });
    var redirect = "{{url_for('eval.test')}}";
    $.redirectPost(redirect, {qno:"{{qno}}"});
    return false;
});
</script>

{% endblock %}