{% extends "eval/base_type.html" %}
{% block title %}Coding Question{% endblock %}

{% block page_content %}

<h1>{{task_data["title"]}}</h1>
<h4>{{task_data["description"]}}</h2>
<br>
<h2>Instructions</h2>
<h4>{{task_data["instructions"]}}</h2>
<br>
<a href="{{task_data['referencelinks']}}">{{task_data["reference_links"]}}</a>
<br>
<div id="editor">
    
</div>








<div id="testcases"></div>
<button type="button" onclick="testSol()">Test</button>
<button type="button" onclick="submitSol()">Submit</button>














<!-- CSS -->
<style type="text/css" media="screen">
    #editor { 
        width: 800px;
        height: 400px;
        border: 1px solid blue; 
    }
</style>

<!-- Scripts -->
<script src="https://pagecdn.io/lib/ace/1.4.13/ace.js" crossorigin="anonymous" integrity="sha256-bS3VAQePcKYmsvI+8BdG2QJAVb9FbiZLgM5vK2/+TcM=" ></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$.extend(
    {
        redirectPost: function(location, args)
        {
            var form = '';
            $.each( args, function( key, value ) {
                value = value.split('"').join('\"')
                form += '<input type="hidden" name="'+key+'" value="'+value+'">';
            });
            $('<form action="' + location + '" method="GET">' + form + '</form>').appendTo($(document.body)).submit();
        }
    });
</script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/python");

    function testSol(){
        var server_data ={code: editor.getValue(),qno:"{{qno}}",type:"test"};
            $.ajax({
        type: "POST",
        url: "{{url_for('eval.submit')}}",
        data: JSON.stringify(server_data),
        contentType: "application/json",
        dataType: 'json',
        success: function(result) {
            document.getElementById("testcases").innerHTML = result.rows; 
        } 
        });
    };
    function submitSol(){
        var server_data ={code: editor.getValue(),qno:"{{qno}}",type:"task"};
            $.ajax({
        type: "POST",
        url: "{{url_for('eval.submit')}}",
        data: JSON.stringify(server_data),
        contentType: "application/json",
        dataType: 'json',
        success: function(result) {
           console.log("Redirected")
        } 
        });
        var redirect = "{{url_for('eval.test')}}";
        $.redirectPost(redirect, {qno:"{{qno}}"});
    };
</script>


{% endblock %}